<template>  <Header :current-user="this.currentUser"/>  <div v-if="loading" class="position-absolute start-50 mt-4">    <div class="spinner-border" role="status">      <span class="visually-hidden">Loading...</span>    </div>  </div>  <form @submit.prevent="submitNewCar" class="mx-auto border border-1 px-5 py-3" style="margin-top: 75px; width: 600px !important;">    <h1 class="fs-5 text-center">Post car</h1>    <div class="mb-3">      <input class="form-control" type="file" required name="imageInput" id="formFile" @change="getImage">    </div>    <p v-if="!writeYourself" class="text-end text-primary mt-1" @click="handleWriteCar" style="cursor: pointer">      not found in the list ? write it yourself</p>    <p v-else class="text-end text-primary mt-1" @click="handleWriteCar" style="cursor: pointer">      Go back to select!</p>    <select v-if="!writeYourself" class="form-select" aria-label="Default select example" name="brandSelect" v-model="newCar.brand" @change="createModelOptions">      <option selected>Brand</option>      <option          v-for="brand in brandSelectOptions"          :value="brand.nome"          :id="brand.codigo"      >        {{ brand.nome }}      </option>    </select>    <input v-else type="text" class="form-control mb-2" id="brand" placeholder="Brand" v-model="newCar.brand">    <select v-if="!writeYourself" class="form-select mt-4 mb-2" aria-label="Model" name="modelSelect" v-model="newCar.model" @change="createYearOptions">      <option selected>Model</option>      <option          v-for="model in modelsSelectOptions"          :value="model.nome"          :id="model.codigo"      >        {{ model.nome }}      </option>    </select>    <input v-else type="text" class="form-control mt-4 mb-2" id="model" placeholder="Model" v-model="newCar.model" >    <select v-if="!writeYourself" class="form-select mt-4 mb-2" aria-label="Default select example" name="yearSelect" v-model="newCar.year" @change="getPriceCar">      <option selected>Year</option>      <option          v-for="year in yearsSelectOptions"          :value="year.codigo"      >        {{ year.codigo.split('-', 1)[0] }}      </option>    </select>    <input v-else type="number" class="form-control mt-4 mb-2" maxlength="4" id="year" placeholder="" v-model="newCar.year">    <div class="mb-3" v-if="newCar.carFuel && !writeYourself">      <p>Car fuel: {{ this.newCar.carFuel }}</p>    </div>    <label v-if="writeYourself" for="carFuel" class="label mt-2">Car Fuel</label>    <select v-if="writeYourself" class="form-select mb-2" aria-label="Default select example" v-model="newCar.carFuel">      <option selected value="Diesel">Diesel</option>      <option value="Gasolina">Gasolina</option>    </select>    <div class="d-flex align-items-cente gap-3 mt-3">      <div class="input-group mb-3 w-25">        <div class="input-group-text">          <input class="form-check-input mt-0" type="checkbox"  @click="newCar.hasAirBag = !newCar.hasAirBag" aria-label="Checkbox for following text input">        </div>        <input type="text" readonly class="form-control" value="Air Bag" aria-label="Text input with checkbox">      </div>      <div class="input-group mb-3" style="width: 170px">        <div class="input-group-text">          <input class="form-check-input mt-0" type="checkbox" v-model="newCar.hasInsurance"  aria-label="Checkbox for following text input">        </div>        <input type="text" readonly class="form-control" value="Has insurance" aria-label="Text input with checkbox">      </div>    </div>    <div class="mb-3">      <label for="exampleFormControlInput1" class="form-label">Price</label>     <input type="text" class="form-control" id="exampleFormControlInput1" v-model="newCar.price" :placeholder="currentFipeCarPrice">    </div>    <div class="mb-3">      <label for="exampleFormControlInput1" class="form-label">License plate</label>      <input type="text" maxlength="8" class="form-control" id="exampleFormControlInput1" v-model="newCar.licensePlate" placeholder="XXX-XXXX">    </div>    <button type="submit" class="btn btn-primary">Create</button>    <div v-if="validators" v-for="validator in this.validators" class="alert alert-danger mt-3" role="alert">      {{ validator[0] }}    </div>  </form></template><script>import Header from '../components/Header.vue';import router from "../routes";import axios from "../axios";export default {  name: "PostCar",  data() {    return {      brandSelectOptions: [],      modelsSelectOptions: [],      yearsSelectOptions: [],      currentFipeCarPrice: '',      newCar: {        brand: 'Brand',        model: 'Model',        year: 'Year',        price: null,        currentFipePrice: null,        image: {},        carFuel: '',        hasAirBag: false,        hasInsurance: false,        licensePlate: '',      },      currentUser: {},      validators: null,      loading: false,      writeYourself: false,    }  },  components: {    Header  },  beforeMount() {    axios.get('http://localhost/api/user')        .then((response) => {          this.currentUser = response.data        })        .catch((error) => router.push({path: '/login'}))  },  beforeCreate(){    let url = 'https://parallelum.com.br/fipe/api/v1/carros/marcas';    axios.get(url, {withCredentials: false})        .then((response) => {          this.brandSelectOptions = response.data;        })        .catch((error) => console.error(error))  },  methods: {    createModelOptions(){      let brandSelect = document.querySelector('select[name="brandSelect"]');      let brandId = brandSelect.options[brandSelect.selectedIndex].id      let url = `https://parallelum.com.br/fipe/api/v1/carros/marcas/${brandId}/modelos`;      axios.get(url, {withCredentials: false})          .then((response) => {            console.log(response)              this.modelsSelectOptions = response.data.modelos          }).catch((error) => console.error(error))    },    createYearOptions(){      let brandSelect = document.querySelector('select[name="brandSelect"]');      let brandId = brandSelect.options[brandSelect.selectedIndex].id;      let modelSelect = document.querySelector('select[name="modelSelect"]');      let modelId = modelSelect.options[modelSelect.selectedIndex].id;      let url = `https://parallelum.com.br/fipe/api/v1/carros/marcas/${brandId}/modelos/${modelId}/anos`;      axios.get(url, {withCredentials: false})          .then((response) => {            for(let year of response.data){              let data = year.nome.split(' ');              this.yearsSelectOptions.push(year)              this.newCar.carFuel = data[1]            }          }).catch((error) => console.error(error))    },    getPriceCar(){      let brandSelect = document.querySelector('select[name="brandSelect"]');      let brandId = brandSelect.options[brandSelect.selectedIndex].id;      let modelSelect = document.querySelector('select[name="modelSelect"]');      let modelId = modelSelect.options[modelSelect.selectedIndex].id;      let yearSelect = document.querySelector('select[name="yearSelect"]');      let yearId = yearSelect.options[yearSelect.selectedIndex].value;      let url = `https://parallelum.com.br/fipe/api/v1/carros/marcas/${brandId}/modelos/${modelId}/anos/${yearId}`;      axios.get(url, {withCredentials: false})          .then(response => {            this.newCar.price = response.data.Valor;            this.newCar.currentFipePrice = response.data.Valor          })          .catch(error => console.log(error))    },    getImage(e){      this.newCar.image = e.target.files[0];    },    submitNewCar(){      let price = this.newCar.price.replace(/[^0-9]/g,'')      this.newCar.price = price;      if(this.newCar.currentFipePrice){        let fipePrice = this.newCar.currentFipePrice.replace(/[^0-9]/g,'')        this.newCar.currentFipePrice = fipePrice;        let year = this.newCar.year.substring(0, this.newCar.year.length -2)        this.newCar.year = year;      }      this.loading = true     setTimeout(() => {       this.loading = false       let url = 'http://localhost/api/store';       axios.post(url, this.newCar, {         headers: {           'content-Type': 'multipart/form-data',         }       }).then((response) => {             if(response.status === 200){               console.log(response.data)               router.push({path: '/home'})             }           })           .catch((error) => {             this.validators = error.response.data.errors             console.log(error)           })     }, 500)    },   handleWriteCar(){      this.writeYourself = !this.writeYourself;    },  }}</script>